<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>test</title>
  <link rel="stylesheet" href="../style/question.css">
  <meta name="viewport" content="width=device-width" />
  <!--//code.jquery.com/~~何か動かなかったので、https:を追加-->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="https://code.jquery.com/jquery-migrate-3.3.2.js"></script>
  <script>
    jQuery.migrateMute = false; // jQuery Migrateの警告を表示する設定
    // なんか必要っぽい？
  </script>
</head>

<body>
  <span></span>
  <div id="progressbar"></div>
  <h1 id="questionNumber"></h1>
  <h1>一番好きな壁紙を選んでください</h1>
  <br>
  <br>
  <div id="display-image"></div>
  <br>
  <input type="button" onclick="back()" value="１つ戻る"><br>
  



  <!-- jsファイルの読み込み -->
  <script src="../store/score.js"></script>
  <script src="../config/fixedItem.js"></script>

  <script>
    /* --- 変数定義 --- */
    // 回答数
    let count = 1;
    // 質問数
    let question_num = 6;
    // 画像表示数
    let image_num = 4;

    /* --- プログレスバーの処理 --- */
    function updateProgressBar() {
      let progress_value = (count / question_num) * 100;
      $("#progressbar").progressbar({
        value: progress_value
      });
      $("#progressbar").find( ".ui-progressbar-value" ).css({
        'background':'#00BFFF'
      });
      $("#progressbar").css({
        'border-radius': '100vh'
      });
    };


    /* --- 初回表示時の処理 --- */
    // storeの初期化
    const score = new scoreStore();

    // １個目の質問文を表示 [HTML上の要素に変数の値を表示する]

    document.getElementById("questionNumber").textContent = "Q1 ";


    // 初回読み込み時に、scoreをリセット
    score.setScore({ answers: [] });

    /* --- 関数 --- */
    function answer(id) {
      let storedScores = score.getScore();

      storedScores.answers.push({ name: "Q" + count, value: id });

      count++;
      const displayImage = document.getElementById('display-image');
      while (displayImage.firstChild) {
        displayImage.removeChild(displayImage.firstChild);
      }
      
      for(i=1;i<5;i++) {
        const imageElement = document.createElement('img');
        imageElement.src = "http://35.187.199.64/images?num="+String(count)+"&id=" + String(i);
        // console.log("http://35.187.199.64/images?num="+String(count)+"&id=" + String(i));
        const this_id = "A" + String(i)
        imageElement.addEventListener('click', () => answer(this_id));
        displayImage.appendChild(imageElement);
      };
      
      score.setScore(storedScores);
      console.log(score.getScore());
      if (count <= question_num) {
        setText();
      } else {
        //jsonデータファイルを作る
        window.location.href = "result.html"
      }
      updateProgressBar(); // プログレスバーの更新
    }


    function setText() {
      document.getElementById("questionNumber").textContent = "Q" + count + " ";
    }

    function back() {
      if (count > 1) {
        count--;//ちょうどいい位置
        let storedScores = score.getScore();
        let last = storedScores.answers.pop();//一番上をpopした
        console.log(last);
        console.log("↑削除");
        score.setScore(storedScores);
        console.log(score.getScore());
        console.log("↑最新");
        updateProgressBar();
        setText();
      } else {
        alert("1つ以上答えて下さい")
      }
    }

    // ページロード時の初期設定
    $(function () {
      updateProgressBar();
    });

    // imgsをfor文で回して画像をHTMLに出力
    window.onload = function (){
      const displayImage = document.getElementById('display-image');
      for(i=1;i<5;i++) {
        const imageElement = document.createElement('img');
        imageElement.src = "http://35.187.199.64/images?num="+String(count)+"&id=" + String(i);
        // console.log("http://35.187.199.64/images?num="+String(count)+"&id=" + String(i));
        const this_id = "A" + String(i)
        imageElement.addEventListener('click', () => answer(this_id));
        displayImage.appendChild(imageElement);
      };
    }
    
    

  </script>
</body>